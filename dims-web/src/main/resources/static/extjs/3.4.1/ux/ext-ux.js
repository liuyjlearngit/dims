Ext.ux.Spinner=Ext.extend(Ext.util.Observable,{incrementValue:1,alternateIncrementValue:5,triggerClass:"x-form-spinner-trigger",splitterClass:"x-form-spinner-splitter",alternateKey:Ext.EventObject.shiftKey,defaultValue:0,accelerate:!1,constructor:function(a){Ext.ux.Spinner.superclass.constructor.call(this,a);Ext.apply(this,a);this.mimicing=!1},init:function(a){this.field=a;a.afterMethod("onRender",this.doRender,this);a.afterMethod("onEnable",this.doEnable,this);a.afterMethod("onDisable",this.doDisable,
this);a.afterMethod("afterRender",this.doAfterRender,this);a.afterMethod("onResize",this.doResize,this);a.afterMethod("onFocus",this.doFocus,this);a.beforeMethod("onDestroy",this.doDestroy,this)},doRender:function(a,b){var c=this.el=this.field.getEl(),d=this.field;d.wrap?this.wrap=d.wrap.addClass("x-form-field-wrap"):d.wrap=this.wrap=c.wrap({cls:"x-form-field-wrap"});this.trigger=this.wrap.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass});d.width||this.wrap.setWidth(c.getWidth()+
this.trigger.getWidth());this.splitter=this.wrap.createChild({tag:"div",cls:this.splitterClass,style:"width:13px; height:2px;"});this.splitter.setRight(Ext.isIE?1:2).setTop(10).show();this.proxy=this.trigger.createProxy("",this.splitter,!0);this.proxy.addClass("x-form-spinner-proxy");this.proxy.setStyle("left","0px");this.proxy.setSize(14,1);this.proxy.hide();this.dd=new Ext.dd.DDProxy(this.splitter.dom.id,"SpinnerDrag",{dragElId:this.proxy.id});this.initTrigger();this.initSpinner()},doAfterRender:function(){var a;
Ext.isIE&&this.el.getY()!=(a=this.trigger.getY())&&(this.el.position(),this.el.setY(a))},doEnable:function(){this.wrap&&this.wrap.removeClass(this.field.disabledClass)},doDisable:function(){this.wrap&&(this.wrap.addClass(this.field.disabledClass),this.el.removeClass(this.field.disabledClass))},doResize:function(a,b){"number"==typeof a&&this.el.setWidth(a-this.trigger.getWidth());this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())},doFocus:function(){this.mimicing||(this.wrap.addClass("x-trigger-wrap-focus"),
this.mimicing=!0,Ext.get(Ext.isIE?document.body:document).on("mousedown",this.mimicBlur,this,{delay:10}),this.el.on("keydown",this.checkTab,this))},checkTab:function(a){a.getKey()==a.TAB&&this.triggerBlur()},mimicBlur:function(a){!this.wrap.contains(a.target)&&this.field.validateBlur(a)&&this.triggerBlur()},triggerBlur:function(){this.mimicing=!1;Ext.get(Ext.isIE?document.body:document).un("mousedown",this.mimicBlur,this);this.el.un("keydown",this.checkTab,this);this.field.beforeBlur();this.wrap.removeClass("x-trigger-wrap-focus");
this.field.onBlur.call(this.field)},initTrigger:function(){this.trigger.addClassOnOver("x-form-trigger-over");this.trigger.addClassOnClick("x-form-trigger-click")},initSpinner:function(){this.field.addEvents({spin:!0,spinup:!0,spindown:!0});this.keyNav=new Ext.KeyNav(this.el,{up:function(a){a.preventDefault();this.onSpinUp()},down:function(a){a.preventDefault();this.onSpinDown()},pageUp:function(a){a.preventDefault();this.onSpinUpAlternate()},pageDown:function(a){a.preventDefault();this.onSpinDownAlternate()},
scope:this});this.repeater=new Ext.util.ClickRepeater(this.trigger,{accelerate:this.accelerate});this.field.mon(this.repeater,"click",this.onTriggerClick,this,{preventDefault:!0});this.field.mon(this.trigger,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,mousemove:this.onMouseMove,mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,preventDefault:!0});this.field.mon(this.wrap,"mousewheel",this.handleMouseWheel,this);this.dd.setXConstraint(0,0,10);this.dd.setYConstraint(1500,1500,10);
this.dd.endDrag=this.endDrag.createDelegate(this);this.dd.startDrag=this.startDrag.createDelegate(this);this.dd.onDrag=this.onDrag.createDelegate(this)},onMouseOver:function(){if(!this.disabled){var a=this.getMiddle();this.tmpHoverClass=Ext.EventObject.getPageY()<a?"x-form-spinner-overup":"x-form-spinner-overdown";this.trigger.addClass(this.tmpHoverClass)}},onMouseOut:function(){this.trigger.removeClass(this.tmpHoverClass)},onMouseMove:function(){if(!this.disabled){var a=this.getMiddle();Ext.EventObject.getPageY()>
a&&"x-form-spinner-overup"==this.tmpHoverClass||Ext.EventObject.getPageY()}},onMouseDown:function(){if(!this.disabled){var a=this.getMiddle();this.tmpClickClass=Ext.EventObject.getPageY()<a?"x-form-spinner-clickup":"x-form-spinner-clickdown";this.trigger.addClass(this.tmpClickClass)}},onMouseUp:function(){this.trigger.removeClass(this.tmpClickClass)},onTriggerClick:function(){if(!this.disabled&&!this.el.dom.readOnly){var a=this.getMiddle();this["onSpin"+(Ext.EventObject.getPageY()<a?"Up":"Down")]()}},
getMiddle:function(){var a=this.trigger.getTop(),b=this.trigger.getHeight();return a+b/2},isSpinnable:function(){return this.disabled||this.el.dom.readOnly?(Ext.EventObject.preventDefault(),!1):!0},handleMouseWheel:function(a){if(0!=this.wrap.hasClass("x-trigger-wrap-focus")){var b=a.getWheelDelta();0<b?(this.onSpinUp(),a.stopEvent()):0>b&&(this.onSpinDown(),a.stopEvent())}},startDrag:function(){this.proxy.show();this._previousY=Ext.fly(this.dd.getDragEl()).getTop()},endDrag:function(){this.proxy.hide()},
onDrag:function(){if(!this.disabled){var a=Ext.fly(this.dd.getDragEl()).getTop(),b="";this._previousY>a&&(b="Up");this._previousY<a&&(b="Down");if(""!=b)this["onSpin"+b]();this._previousY=a}},onSpinUp:function(){if(0!=this.isSpinnable())if(1==Ext.EventObject.shiftKey)this.onSpinUpAlternate();else this.spin(!1,!1),this.field.fireEvent("spin",this),this.field.fireEvent("spinup",this)},onSpinDown:function(){if(0!=this.isSpinnable())if(1==Ext.EventObject.shiftKey)this.onSpinDownAlternate();else this.spin(!0,
!1),this.field.fireEvent("spin",this),this.field.fireEvent("spindown",this)},onSpinUpAlternate:function(){0!=this.isSpinnable()&&(this.spin(!1,!0),this.field.fireEvent("spin",this),this.field.fireEvent("spinup",this))},onSpinDownAlternate:function(){0!=this.isSpinnable()&&(this.spin(!0,!0),this.field.fireEvent("spin",this),this.field.fireEvent("spindown",this))},spin:function(a,b){var c=parseFloat(this.field.getValue()),d=1==b?this.alternateIncrementValue:this.incrementValue;1==a?c-=d:c+=d;c=isNaN(c)?
this.defaultValue:c;c=this.fixBoundries(c);this.field.setRawValue(c)},fixBoundries:function(a){void 0!=this.field.minValue&&a<this.field.minValue&&(a=this.field.minValue);void 0!=this.field.maxValue&&a>this.field.maxValue&&(a=this.field.maxValue);return this.fixPrecision(a)},fixPrecision:function(a){var b=isNaN(a);return this.field.allowDecimals&&-1!=this.field.decimalPrecision&&!b&&a?parseFloat(parseFloat(a).toFixed(this.field.decimalPrecision)):b?"":a},doDestroy:function(){this.trigger&&this.trigger.remove();
this.wrap&&(this.wrap.remove(),delete this.field.wrap);this.splitter&&this.splitter.remove();this.dd&&(this.dd.unreg(),this.dd=null);this.proxy&&this.proxy.remove();this.repeater&&this.repeater.purgeListeners()}});Ext.form.Spinner=Ext.ux.Spinner;Ext.ns("Ext.ux.form");
Ext.ux.form.SpinnerField=Ext.extend(Ext.form.NumberField,{actionMode:"wrap",deferHeight:!0,autoSize:Ext.emptyFn,onBlur:Ext.emptyFn,adjustSize:Ext.BoxComponent.prototype.adjustSize,constructor:function(a){var b=Ext.copyTo({},a,"incrementValue,alternateIncrementValue,accelerate,defaultValue,triggerClass,splitterClass"),b=this.spinner=new Ext.ux.Spinner(b),b=a.plugins?Ext.isArray(a.plugins)?a.plugins.push(b):[a.plugins,b]:b;Ext.ux.form.SpinnerField.superclass.constructor.call(this,Ext.apply(a,{plugins:b}))},
getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},alignErrorIcon:function(){this.wrap&&this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])},validateBlur:function(){return!0}});Ext.reg("spinnerfield",Ext.ux.form.SpinnerField);Ext.form.SpinnerField=Ext.ux.form.SpinnerField;Ext.ns("Ext.ux.form");Ext.ux.form.TimePickerField=function(a){Ext.ux.form.TimePickerField.superclass.constructor.call(this,a)};
Ext.extend(Ext.ux.form.TimePickerField,Ext.form.Field,{defaultAutoCreate:{tag:"div"},cls:"x-form-timepickerfield",hoursSpinner:null,minutesSpinner:null,secondsSpinner:null,spinnerCfg:{width:40},spinnerFixBoundries:function(a){a<this.field.minValue&&(a=this.field.maxValue);a>this.field.maxValue&&(a=this.field.minValue);return this.fixPrecision(a)},onRender:function(a,b){Ext.ux.form.TimePickerField.superclass.onRender.call(this,a,b);this.rendered=!1;this.date=new Date;var c={};this.value?(c=this._valueSplit(this.value),
this.date.setHours(c.h),this.date.setMinutes(c.m),this.date.setSeconds(c.s),delete this.value):c={h:this.date.getHours(),m:this.date.getMinutes(),s:this.date.getSeconds()};var d=Ext.DomHelper.append(this.el,{tag:"div"}),h=Ext.apply({},this.spinnerCfg,{renderTo:d,readOnly:this.readOnly,disabled:this.disabled,listeners:{spin:{fn:this.onSpinnerChange,scope:this},valid:{fn:this.onSpinnerChange,scope:this},afterrender:{fn:function(a){a.wrap.applyStyles("float: left")},single:!0}}});this.hoursSpinner=new Ext.ux.form.SpinnerField(Ext.apply({},
h,{minValue:0,maxValue:23,cls:"first",value:c.h}));this.minutesSpinner=new Ext.ux.form.SpinnerField(Ext.apply({},h,{minValue:0,maxValue:59,value:c.m}));this.secondsSpinner=new Ext.ux.form.SpinnerField(Ext.apply({},h,{minValue:0,maxValue:59,value:c.s}));Ext.DomHelper.append(d,{tag:"div",cls:"x-form-clear-left"});this.rendered=!0},_valueSplit:function(a){a=a.split(":");return{h:0<a.length?a[0]:0,m:1<a.length?a[1]:0,s:2<a.length?a[2]:0}},onSpinnerChange:function(){this.rendered&&this.fireEvent("change",
this,this.getRawValue())},disable:function(){Ext.ux.form.TimePickerField.superclass.disable.call(this);this.hoursSpinner.disable();this.minutesSpinner.disable();this.secondsSpinner.disable()},enable:function(){Ext.ux.form.TimePickerField.superclass.enable.call(this);this.hoursSpinner.enable();this.minutesSpinner.enable();this.secondsSpinner.enable()},setReadOnly:function(a){Ext.ux.form.TimePickerField.superclass.setReadOnly.call(this,a);this.hoursSpinner.setReadOnly(a);this.minutesSpinner.setReadOnly(a);
this.secondsSpinner.setReadOnly(a)},clearInvalid:function(){Ext.ux.form.TimePickerField.superclass.clearInvalid.call(this);this.hoursSpinner.clearInvalid();this.minutesSpinner.clearInvalid();this.secondsSpinner.clearInvalid()},getRawValue:function(){if(this.hoursSpinner)return{h:this.hoursSpinner.getValue(),m:this.minutesSpinner.getValue(),s:this.secondsSpinner.getValue()};this.date=new Date;return{h:this.date.getHours(),m:this.date.getMinutes(),s:this.date.getSeconds()}},setRawValue:function(a){this.hoursSpinner.setValue(a.h);
this.minutesSpinner.setValue(a.m);this.secondsSpinner.setValue(a.s)},isValid:function(a){return this.hoursSpinner.isValid(a)&&this.minutesSpinner.isValid(a)&&this.secondsSpinner.isValid(a)},validate:function(){return this.hoursSpinner.validate()&&this.minutesSpinner.validate()&&this.secondsSpinner.validate()},getValue:function(){var a=this.getRawValue();return String.leftPad(a.h,2,"0")+":"+String.leftPad(a.m,2,"0")+":"+String.leftPad(a.s,2,"0")},setValue:function(a){this.rendered?(a=this._valueSplit(a),
this.setRawValue(a),this.validate()):this.value=a}});Ext.form.TimePickerField=Ext.ux.form.TimePickerField;Ext.reg("timepickerfield",Ext.form.TimePickerField);Ext.ns("Ext.ux.form");
Ext.DateTimePicker=Ext.extend(Ext.DatePicker,{timeFormat:"g:i:s A",timeLabel:"\u65f6\u95f4",timeWidth:100,initComponent:function(){Ext.DateTimePicker.superclass.initComponent.call(this);this.id=Ext.id()},onRender:function(a,b){Ext.DateTimePicker.superclass.onRender.apply(this,arguments);var c=Ext.get(Ext.DomQuery.selectNode("table tbody",a.dom));Ext.DomHelper.insertBefore(c.last(),{tag:"tr",children:[{tag:"td",cls:"x-date-bottom",html:this.timeLabel,style:"width:30;"},{tag:"td",cls:"x-date-bottom ux-timefield",
colspan:"2"}]},!0);this.tf.render(c.child("td.ux-timefield"));(c=this.getEl().parent("div.x-layer"))&&c.setStyle("height",c.getHeight()+31)},setValue:function(a){this.tf||(this.tf=new Ext.ux.form.TimePickerField,this.tf.ownerCt=this);this.value=this.getDateTime(a)},getDateTime:function(a){this.tf&&(this.tf.getValue(),a=Date.parseDate(a.format(this.dateFormat)+" "+this.tf.getValue(),this.format));return a},selectToday:function(){this.todayBtn&&!this.todayBtn.disabled&&(this.value=this.getDateTime(new Date),
this.fireEvent("select",this,this.value))}});Ext.reg("datetimepickerfield",Ext.DateTimePicker);
2<parseInt(Ext.version.substr(0,1),10)?(Ext.menu.DateTimeItem=Ext.DateTimePicker,Ext.override(Ext.menu.DateMenu,{initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);if(this.strict=Ext.isIE7&&Ext.isStrict)this.on("show",this.onShow,this,{single:!0,delay:20});Ext.apply(this,{plain:!0,showSeparator:!1,items:this.picker=new Ext.DatePicker(Ext.apply({internalRender:this.strict||!Ext.isIE,ctCls:"x-menu-date-item"},this.initialConfig))});Ext.menu.DateMenu.superclass.initComponent.call(this);
this.relayEvents(this.picker,["select"]);this.on("select",this.menuHide,this);if(this.handler)this.on("select",this.handler,this.scope||this)}})):(Ext.menu.DateTimeItem=function(a){Ext.menu.DateTimeItem.superclass.constructor.call(this,new Ext.DateTimePicker(a),a);this.picker=this.component;this.addEvents("select");this.picker.on("render",function(a){a.getEl().swallowEvent("click");a.container.addClass("x-menu-date-item")});this.picker.on("select",this.onSelect,this)},Ext.extend(Ext.menu.DateTimeItem,
Ext.menu.DateMenu,{onSelect:function(a,b){this.fireEvent("select",this,b,a);Ext.menu.DateTimeItem.superclass.handleClick.call(this)}}));Ext.menu.DateTimeMenu=function(a){Ext.menu.DateTimeMenu.superclass.constructor.call(this,a);this.plain=!0;a=new Ext.menu.DateTimeItem(a);this.add(a);this.picker=a;this.relayEvents(a,["select"]);this.on("beforeshow",function(){this.picker&&this.picker.hideMonthPicker(!0)},this)};
Ext.extend(Ext.menu.DateTimeMenu,Ext.menu.Menu,{cls:"x-date-menu",beforeDestroy:function(){this.picker.destroy()},hide:function(a){if(this.picker.tf.innerList&&(Ext.EventObject.within(this.picker.tf.innerList)||Ext.get(Ext.EventObject.getTarget())==this.picker.tf.innerList))return!1;this.el&&this.isVisible()&&(this.fireEvent("beforehide",this),this.activeItem&&(this.activeItem.deactivate(),this.activeItem=null),this.el.hide(),this.hidden=!0,this.fireEvent("hide",this));!0===a&&this.parentMenu&&this.parentMenu.hide(!0)}});
Ext.ux.form.DateTimeField=Ext.extend(Ext.form.DateField,{dateFormat:"Y-m-d",timeFormat:"H:i:s",defaultAutoCreate:{tag:"input",type:"text",size:"20",autocomplete:"off"},initComponent:function(){Ext.ux.form.DateTimeField.superclass.initComponent.call(this);this.format=this.dateFormat+" "+this.timeFormat;this.afterMethod("afterRender",function(){this.getEl().applyStyles("top:0")})},getValue:function(){return this.parseDate(Ext.form.DateField.superclass.getValue.call(this))||""},onTriggerClick:function(){if(!this.disabled){null==
this.menu&&(this.menu=new Ext.menu.DateTimeMenu);Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.ddMatch,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,timeFormat:this.timeFormat,dateFormat:this.dateFormat,showToday:this.showToday,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});if(this.menuEvents)this.menuEvents("on");
else this.menu.on(Ext.apply({},this.menuListeners,{scope:this}));this.menu.picker.setValue(this.getValue()||new Date);this.menu.show(this.el,"tl-bl?")}}});Ext.reg("datetimefield",Ext.ux.form.DateTimeField);Ext.namespace("Ext.ux.layout");
Ext.ux.layout.TableFormLayout=Ext.extend(Ext.layout.TableLayout,{monitorResize:!0,setContainer:function(){Ext.layout.FormLayout.prototype.setContainer.apply(this,arguments);this.currentColumn=this.currentRow=0;this.cells=[]},renderItem:function(a,b,c){a&&!a.rendered&&(b=Ext.get(this.getNextCell(a)),b.addClass("x-table-layout-column-"+this.currentColumn),Ext.layout.FormLayout.prototype.renderItem.call(this,a,0,b))},getLayoutTargetSize:Ext.layout.AnchorLayout.prototype.getLayoutTargetSize,getTemplateArgs:Ext.layout.FormLayout.prototype.getTemplateArgs,
onLayout:function(a,b){Ext.ux.layout.TableFormLayout.superclass.onLayout.call(this,a,b);b.hasClass("x-table-form-layout-ct")||b.addClass("x-table-form-layout-ct");var c=this.getLayoutTargetSize(a,b),d,h;a.anchorSize?"number"==typeof a.anchorSize?d=a.anchorSize:(d=a.anchorSize.width,h=a.anchorSize.height):(d=a.initialConfig.width,h=a.initialConfig.height);var m=this.getRenderedItems(a),p=m.length,l,e,f,g,k,q=[],n;for(l=0;l<p;l++){e=m[l];k=e.getEl().parent(".x-table-layout-cell");if(this.columnWidths){g=
parseInt(k.dom.className.replace(/.*x\-table\-layout\-column\-([\d]+).*/,"$1"));n=f=0;for(j=g;j<g+(e.colspan||1);j++)f+=this.columnWidths[j],n+=10;g=c.width*f-n}else g=c.width/this.columns*(e.colspan||1);k.setWidth(g);g-=10;k=k.getHeight();e.anchor||!e.items||Ext.isNumber(e.width)||Ext.isIE6&&Ext.isStrict||(e.anchor=this.defaultAnchor);e.anchor&&(f=e.anchorSpec,f||(f=e.anchor.split(" "),e.anchorSpec=f={right:this.parseAnchor(f[0],e.initialConfig.width,d),bottom:this.parseAnchor(f[1],e.initialConfig.height,
h)}),g=f.right?this.adjustWidthAnchor(f.right(g),e):void 0,k=f.bottom?this.adjustHeightAnchor(f.bottom(k),e):void 0,(g||k)&&q.push({comp:e,width:g||void 0,height:k||void 0}))}l=0;for(p=q.length;l<p;l++)e=q[l],e.comp.setSize(e.width,e.height)},parseAnchor:function(a,b,c){if(a&&"none"!=a){var d;if(/^(r|right|b|bottom)$/i.test(a)){var h=c-b;return function(a){if(a!==d)return d=a,a-h}}if(-1!=a.indexOf("%")){var m=.01*parseFloat(a.replace("%",""));return function(a){if(a!==d)return d=a,Math.floor(a*m)}}a=
parseInt(a,10);if(!isNaN(a))return function(b){if(b!==d)return d=b,b+a}}return!1},adjustWidthAnchor:function(a,b){return a-(b.isFormField?b.hideLabel?0:this.labelAdjust:0)},adjustHeightAnchor:function(a,b){return a},isValidParent:function(a,b){return a.getPositionEl().up("table",6).dom.parentNode===(b.dom||b)},getLabelStyle:Ext.layout.FormLayout.prototype.getLabelStyle,labelSeparator:Ext.layout.FormLayout.prototype.labelSeparator,trackLabels:Ext.layout.FormLayout.prototype.trackLabels,onFieldShow:Ext.layout.FormLayout.prototype.onFieldShow,
onFieldHide:Ext.layout.FormLayout.prototype.onFieldHide});Ext.Container.LAYOUTS.tableform=Ext.ux.layout.TableFormLayout;
